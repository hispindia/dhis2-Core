<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script src="//dhis2-cdn.org/v221/ext/ext-all.js"></script>
    <link rel="stylesheet" href="../css/w3.css">
    <script src="../js/jquery.min.js"></script>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Punjab Portal</title>
    <script src="../constants.js"></script>
</head>
<style>
    #footer{

        right: 0;
        bottom: 0;
        left: 0;
        padding: 1rem;
        background-color:#2978B3;
        text-align: center;
    }
    header
    {
        background-color:#2978B3;
    }
    #formHeader
    {
        background-color:#2978B3;
    }
    body
    {
        background-color:#E5E3E3;
    }
    .rating
    {
        unicode-bidi: bidi-override;
        direction: rtl;
        text-align: center;
    }
    .rating > span
    {
        display: inline-block;
        position: relative;
        width: 1.1em;
    }
    .rating > span:hover,
    .rating > span:hover ~ span {
        color: transparent;
    }
    .rating > span:hover:before,
    .rating > span:hover ~ span:before {
        content: "\2605";
        position: absolute;
        left: 0;
        color: gold;
    }
</style>
<script>



    Ext.onReady( function() {
        var procedures=[],costs=[];
        var dNames=[],dQual=[],dMedical=[],dOrgunit=[];
        var query = decodeURIComponent(window.location.search);
        var ouid;
        var title;
        query = query.substring(1);
        var params = query.split("&");
        for (var i=0;i<params.length;i++) {
            var param = params[i].split("=");
            switch(param[0]) {
                case "ouid":
                    ouid = param[1];
                    setLinks(ouid);

            }
        }
        function setLinks(ouid) {
            var header = {
                "Authorization": "Basic " + btoa("homepage" + ':' + "Homepage123")
            };

            $.getJSON("../../../../api/organisationUnits/"+ouid+"?fields=displayName", function (data) {

                document.getElementById('facility').innerHTML = '<strong>Name of Health Facility : </strong>'+data.displayName;

            });
            $.getJSON("../../../../api/analytics/events/query/oKibT84LSdV.json?stage=jujDNAJZEU8&dimension=pe:THIS_YEAR;LAST_5_YEARS&dimension=ou:"+ouid+"&dimension=O2k16XtvCQ8&dimension=VdaNJktWZ7E&dimension=l8VDWUvIHmv&dimension=OQZwDkZiisR&displayProperty=NAME", function (data) {
                var dNames=[],dQual=[],dMedical=[],dOrgunit=[],dSpecialities=[];
                var nursecount= 0,paracount=0;
                for(var i=0;i<data.rows.length;i++){


                    if(data.rows[i][8]=="Nurses")
                    {
                        nursecount++
                    }
                    else if(data.rows[i][8]=="Paramedical")
                    {
                        paracount++;
                    }
                    else if(data.rows[i][8]=="Doctors")
                    {
                        dOrgunit.push(data.rows[i][5]);
                        dQual.push(data.rows[i][9])
                        dMedical.push(data.rows[i][8]);
                        dNames.push(data.rows[i][10]);
                        dSpecialities.push(data.rows[i][11]);
                    }

                }
                var htmlstring="";
                htmlstring='<table id="doctors" class="w3-table w3-striped w3-hoverable"><tr style=" background-color: #2978B3; color: white;"><th style="width:20%"><p><strong>Doctors List</strong></p></th><th style="width:30%"><p><strong>Name</strong></p></th><th style="width:50%"><p><p><strong>Highest qualification</strong></p></th><th style="width:50%"><p><strong></strong></p><p><strong>Specialities</strong></p></th></tr>'
                for(var i =0;i<=dNames.length-1;i++)
                {
                    document.getElementById("nurses").innerHTML= "<Strong>Number of Nurses :- </strong>"+nursecount;
                  document.getElementById("paramedical").innerHTML= "<strong>Number of Paramedical Staff :-</strong>"+paracount;
                    htmlstring+='<tr><td><p>'+dMedical[i]+'</p></td><td><p>'+dNames[i]+'</p></td><td><p>'+dQual[i]+'</p></td><td><p>'+dSpecialities[i]+'</p></td></tr>'

                }
                htmlstring+='</table>';
                $("#procedureid").empty();
                $("#procedureid").append(htmlstring);
            });

        }
    });

</script>
<script type="text/javascript">
    var tableToExcel = (function() {
        var uri = 'data:application/vnd.ms-excel;base64,'
                , template = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>'
                , base64 = function(s) { return window.btoa(unescape(encodeURIComponent(s))) }
                , format = function(s, c) { return s.replace(/{(\w+)}/g, function(m, p) { return c[p]; }) }
        return function(table, name) {
            if (!table.nodeType) table = document.getElementById(table)
            var ctx = {worksheet: name || 'Worksheet', table: table.innerHTML}
            window.location.href = uri + base64(format(template, ctx))
        }
    })()
</script>
<body>
<header class="w3-card" >
    <h2 style="color:#fff; text-align:center;  font-weight: bold;">Staff Details</h2>
</header>
<div style="margin-left:20%; margin-right:20%;">
    <table>
        <tr>
            <td>
                <input type="button" onclick="tableToExcel('doctors', 'W3C Example Table')" value="Export to Excel">
                <input type="button" onclick="window.print();" value="Print">
            </td>
        </tr>
    </table>
</div>

</br>
<div  class="w3-card-2" style=" background-color: #2978B3;margin-left: 20%;margin-right: 20%; color: white;">
    <table class="w3-table">

        <tr>
            <td colspan="2" style="text-align:center"><h4 id="facility">Facility</h4>
            </td>

        </tr>

        <tr>
            <td style="text-align: center"><p id="nurses"></p></td>
            <td style="text-align: center"><p id="paramedical"></p></td>
        </tr>
    </table>
</div>

<div class="w3-card-4" style="margin-left:20%; margin-right:20%;background-color:white;">
    <div id="procedureid" class="w3-container" style="padding-top: 10px; padding-bottom: 10px;"></div>
</div>
</body>
</html>
